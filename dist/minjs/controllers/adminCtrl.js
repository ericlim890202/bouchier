!function(){"use strict";function e(e,t,o,n,a,r,d,u,c,l){var i=e;t.getList().then(function(o){i.products=o,i.editProduct=function(e){i.newProduct=e,i.isProductNew=!1,i.showModal()},i.addProduct=function(){i.newProduct={},i.isProductNew=!0,i.showModal()},i.saveProduct=function(){i.newProduct.customItem=!1,t.post(i.newProduct).then(function(){t.getList().then(function(e){i.newProduct.customItem=!1,i.products=e,i.openModal.hide()})})},i.removeProduct=function(e){i.products.remove(e).then(function(){t.getList().then(function(e){i.products=e,i.openDeleteModal.hide()})})},i.pageSize=10,i.currentPage=1,i.openModal=n({scope:i,templateUrl:"apps/admin/modals/newProductModal.html",show:!1,animation:"am-fade-and-slide-top",placement:"center-top"}),i.showModal=function(e){i.modalItem=e,i.openModal.$promise.then(i.openModal.show)},i.openDeleteModal=n({scope:i,templateUrl:"apps/admin/modals/deleteModal.html",show:!1,animation:"am-fade-and-slide-top",placement:"center"}),i.deleteProductModal=function(e){i.modalItem=e,i.openDeleteModal.$promise.then(i.openDeleteModal.show)},i.measurementTypes=["weight","quantity"],i.meatTypes=["ham","turkey","beef","pork","poultry","lamb","sausage","other"],i.deleteImage=function(){i.newProduct.image=""},e.uploadFiles=function(e,t){i.f=e,i.errFile=t&&t[0],e&&(e.upload=d.upload({url:"/uploads",data:{file:e}}),e.upload.then(function(e){u(function(){i.newProduct.image=e.data.url})}))}}),e.import=function(){c.get("old-products.csv").success(function(o,n,a,r){var o=e.parsecsv(o);angular.forEach(o,function(e,o){if(o>0){var n=!1,a=!1;"TRUE"==e[2]&&(n=!0),"TRUE"==e[3]&&(a=!0);var r={code:e[0],title:e[1],meat:"",byWeight:n,byUnit:a,customItem:!0}}t.post(r),console.log(r)})}).error(function(e,t,o,n){console.log("error",e)})},e.parsecsv=function(e){for(var t=new RegExp('(\\,|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\,\\r\\n]*))',"gi"),o=[[]],n=null;n=t.exec(e);){var a=n[1];a.length&&","!==a&&o.push([]);var r;r=n[2]?n[2].replace(new RegExp('""',"g"),'"'):n[3],o[o.length-1].push(r)}return o}}angular.module("app").controller("adminCtrl",e),e.$inject=["$scope","Products","order","$modal","$state","$stateParams","Upload","$timeout","$http","$tooltip"]}();